{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">–ö–Ω–∏–∂–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥</h2>

{% if request.user.librarian %}
<a href="{% url 'create_book' %}" class="btn btn-primary mb-4">–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>
{% endif %}

<table class="table table-striped table-bordered">
    <thead class="table-light">
    <tr>
        <th>ID</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ê–≤—Ç–æ—Ä</th>
        <th>–ñ–∞–Ω—Ä</th>
        <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
    </tr>
    </thead>
    <tbody>
    {% for book in books %}
    <tr>
        <td>
            {{ book.id }}
        </td>
        <td>
            {{ book.title }}

            <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('{{ book.title }}')">
                üì§
            </button>
        </td>
        <td>{{ book.author }}</td>
        <td>{{ book.genre }}</td>
        <td>
            {% if request.user.librarian %}
            <!--  –î–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—è -->
            {% if book.is_borrowed %}
            <button class="btn btn-secondary" disabled>
                –í–∑—è—Ç–∞ —á–∏—Ç–∞—Ç–µ–ª–µ–º
                {% else %}
                <button class="btn btn-success" disabled>
                    –î–æ—Å—Ç—É–ø–Ω–∞
                    {% endif %}
                    {% else %}
                    <!--  –¥–ª—è —á–∏—Ç–∞—Ç–µ–ª–µ–π  -->
                    {% if book.is_borrowed %}
                    {% if book.borrowed_by == request.user.reader %}
                    <form method="post" action="{% url 'borrow_book' book.id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">
                            –í–µ—Ä–Ω—É—Ç—å
                        </button>
                    </form>
                    {% else %}
                    <button class="btn btn-secondary" disabled>
                        –í–∑—è—Ç–∞ —á–∏—Ç–∞—Ç–µ–ª–µ–º
                    </button>
                    {% endif %}
                    {% else %}
                    <form method="post" action="{% url 'borrow_book' book.id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">
                            –í–∑—è—Ç—å
                        </button>
                    </form>
                    {% endif %}
                    {% endif %}
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            alert('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ' + text);
        }).catch(function(error) {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞: ', error);
        });
    }
</script>
{% endblock %}
